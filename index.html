<!DOCTYPE html>
<html lang="en">
   <head>
      <!------------------------------------------------------------------>
      <!-- BEGIN HEADER                                                 -->
      <!------------------------------------------------------------------>
      <!-- My Style Sheet -->      
      <link rel="stylesheet" type="text/css" href="index.css">
      <!-- Google Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700' rel='stylesheet' type='text/css'>
      <meta charset="utf-8">
      <title>Melanie Freed</title>
      <!-- d3.js -->
      <!-- <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script> -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
      <script src="http://d3js.org/topojson.v1.min.js"></script>
      <!-- jQuery -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

      <!-- my Javascript objects -->
      <script type="text/javascript" src="PageMaster.js"></script>
      <script type="text/javascript" src="TreeDrawing.js"></script>
      <script type="text/javascript" src="AboutPage.js"></script>
      <script type="text/javascript" src="Projects.js"></script> 
      <script type="text/javascript" src="Papers.js"></script>

      <!------------------------------------------------------------------>
      <!-- END HEADER                                                   -->
      <!------------------------------------------------------------------>
   </head>
   <body>
      <!------------------------------------------------------------------>
      <!-- BEGIN BODY                                                   -->
      <!------------------------------------------------------------------>

      <script type="text/javascript">

         /////////////////////////////////////////////////////////////////////  
         // GLOBAL OBJECT
         ///////////////////////////////////////////////////////////////////// 
         var dv={}; // Store all global variables here
         

         /////////////////////////////////////////////////////////////////////  
         // CREATE PAGE
         ///////////////////////////////////////////////////////////////////// 

         // Add Tree Drawing
         dv.TreeDrawing = new TreeDrawing();

         // Generate Page Template
         dv.PageMaster = new PageMaster();

         // Generate About Page
         dv.AboutPage = new AboutPage(dv.PageMaster,dv.TreeDrawing);

         // Generate Projects Page
         dv.Projects = new Projects(dv.PageMaster,dv.AboutPage);

         // Generate Papers Page
         dv.Papers = new Papers(dv.PageMaster,dv.AboutPage);

         // Control Menu Click Behavior
         
         // HOME
         d3.selectAll(".menu.button.home").on("click",function(){

            var d1=$.Deferred();
            var d2=$.Deferred();
            var d3=$.Deferred();
            first();
            $.when(d1,d2,d3).done(second);

            function first() 
            {
               dv.AboutPage.detach(d1);
               dv.Projects.detach(d2);
               dv.Papers.detach(d3);
            }
            function second()
            {
               dv.TreeDrawing.reattach();
               update_copyright();
               updateWindow(); // Because scroll bar from About page might mess things up
            }

         }); 

         // ABOUT
         d3.selectAll(".menu.button.about").on("click",function(){

            var d1=$.Deferred();
            var d2=$.Deferred();
            var d3=$.Deferred();
            first();
            $.when(d1,d2,d3).done(second);

            function first()
            {
               dv.TreeDrawing.detach(d1); 
               dv.Projects.detach(d2);
               dv.Papers.detach(d3);
            }

            function second()
            {
               if (!dv.AboutPage.created) dv.AboutPage.createPage();
               else dv.AboutPage.reattach();
               update_copyright();
               updateWindow(); // Because scroll bar from About page might mess things up

            }

         }); 

         // PROJECTS
         d3.selectAll(".menu.button.projects").on("click",function(){

            var d1=$.Deferred();
            var d2=$.Deferred();
            var d3=$.Deferred();
            first();
            $.when(d1,d2,d3).done(second);

            function first() 
            {
               dv.TreeDrawing.detach(d1); 
               dv.AboutPage.detach(d2);
               dv.Papers.detach(d3);
            }
            function second()
            {
               if (!dv.Projects.created) dv.Projects.createPage();
               else dv.Projects.reattach();
               update_copyright();
               updateWindow(); // Because scroll bar from About page might mess things up
            }

         }); 

         // PAPERS
         d3.selectAll(".menu.button.papers").on("click",function(){

            var d1=$.Deferred();
            var d2=$.Deferred();
            var d3=$.Deferred();
            first();
            $.when(d1,d2,d3).done(second);

            function first() 
            {
               dv.TreeDrawing.detach(d1); 
               dv.AboutPage.detach(d2);
               dv.Projects.detach(d3);
            }
            function second()
            {
               if (!dv.Papers.created) dv.Papers.createPage();
               else dv.Papers.reattach();
               update_copyright();
               updateWindow(); // Because scroll bar from About page might mess things up
            }

         }); 



         /////////////////////////////////////////////////////////////////////  
         // ADD COPYRIGHT SYMBOL
         ///////////////////////////////////////////////////////////////////// 
         var cr=document.createElement("p"),
             el=document.getElementById("svg_menu");
         document.body.insertBefore(cr,el);
         cr.setAttribute("id","copyright");
         cr.innerHTML="Copyright \xA9 2015 Melanie Freed";
         update_copyright();

         function update_copyright() {
            var d1=$.Deferred();
            first();
            $.when(d1).done(second);

            // detach copyright (so that it's position is not included in context size)
            function first() 
            {
               cr.parentNode.removeChild(cr);
               d1.resolve();
            }
            function second()
            {
               // Get size of content
               var ht=Math.max(document.body.scrollHeight, document.body.offsetHeight, 
                               document.documentElement.clientHeight, document.documentElement.scrollHeight, 
                               document.documentElement.offsetHeight );

               // Update copyright position
               var fsize=Math.round(dv.PageMaster.actualFontSize/2),
                   msize=fsize/2;
               var value="margin: "+msize+"px "+msize+"px "+msize+"px "+msize+"px; "+
                          "position: absolute; top: "+(ht-fsize-msize*2)+"px; left: 0; text-align: start; line-height: 1.0; font-size: "+fsize+"px;";
               cr.setAttribute("style",value);

               // Reattach copyright
               var ref=document.getElementById("svg_menu");
               document.body.insertBefore(cr,ref);
            }
         }
         


         /////////////////////////////////////////////////////////////////////  
         // MAKE ADJUSTMENTS ON WINDOW RESIZE
         ///////////////////////////////////////////////////////////////////// 
         window.addEventListener("resize",updateWindow,true); 

         function updateWindow() {

            // Update Menu
            dv.PageMaster.adjustMenu();

            // Update Tree
            if (dv.TreeDrawing.created) dv.TreeDrawing.redrawCanvas();

            // Update About 
            if (dv.AboutPage.created) dv.AboutPage.adjustPage(dv.PageMaster,dv.TreeDrawing);

            // Update Projects
            if (dv.Projects.created) dv.Projects.adjustPage(dv.PageMaster,dv.AboutPage);

            // Update Papers
            if (dv.Papers.created) dv.Papers.adjustPage(dv.PageMaster,dv.AboutPage);

            // Update copyright
            update_copyright()

         } // updateWindow

      </script>

      <!------------------------------------------------------------------>
      <!-- END BODY                                                     -->
      <!------------------------------------------------------------------>
   </body>
</html>
